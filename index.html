<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CIT Professor Network</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #f4f4f4; }
        #main { width: 100%; height: 100vh; }
        .control-panel {
            position: absolute; top: 20px; left: 20px; z-index: 999;
            background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1); font-family: sans-serif;
        }
        /* // <-- ‰øÆÊîπÂ§Ñ: Â¢ûÂä†‰∏ÄÊù°ÊèêÁ§∫‰ø°ÊÅØÁöÑÊ†∑Âºè */
        .hint { font-size: 12px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="control-panel">
        <h3>CIT Research Matrix Visualization</h3>
        <p>Hover nodes to see connections.</p>
        <p class="hint">üñ±Ô∏è Click a node to visit website.</p>
    </div>
    
    <div id="main"></div>

<script type="text/javascript">
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        // Êú∫ÊûÑÈìæÊé•Êò†Â∞ÑË°®
        var orgUrls = {
            "CS": "https://www.cs.cit.tum.de/",
            "MATH": "https://www.math.cit.tum.de/",
            "CE": "https://www.ce.cit.tum.de/",
            "EE": "https://www.ee.cit.tum.de/",
            "MDSI": "https://www.mdsi.tum.de/",
            "MIRMI": "https://www.mirmi.tum.de/",
            "MCML": "https://mcml.ai/",
            "MUDS": "https://www.mu-ds.de/",
            "MIBE": "https://www.bioengineering.tum.de/"
        };

        // ÊòæÁ§∫Âä†ËΩΩÂä®Áîª
        myChart.showLoading();

        // --- Ê†∏ÂøÉ‰øÆÊîπÔºöËØªÂèñÂ§ñÈÉ® JSON Êñá‰ª∂ ---
        $.getJSON('data.json', function (rawData) {
            
            // ÈöêËóèÂä†ËΩΩÂä®Áîª
            myChart.hideLoading();

            var nodes = [];
            var links = [];
            var categories = [{name: 'Professor'}, {name: 'Department'}, {name: 'Institute'}];
            var existMap = {}; 

            // ËæÖÂä©ÂáΩÊï∞
            function addNode(name, category, size, color, url) {
                if (!existMap[name]) {
                    nodes.push({
                        name: name,
                        category: category,
                        symbolSize: size,
                        itemStyle: { color: color },
                        clickUrl: url, 
                        label: { show: size > 20 } 
                    });
                    existMap[name] = true;
                }
            }

            // Â§ÑÁêÜÊï∞ÊçÆ
            rawData.forEach(function (prof) {
                // 1. ÊïôÊéà
                addNode(prof.name, 0, 15, '#5470c6', prof.website);

                // 2. Â≠¶Èô¢
                if (prof.dept) {
                    addNode(prof.dept, 1, 40, '#91cc75', orgUrls[prof.dept]);
                    links.push({ source: prof.name, target: prof.dept });
                }

                // 3. Êú∫ÊûÑ
                if (prof.inst) {
                    prof.inst.forEach(function (inst) {
                        addNode(inst, 2, 50, '#fac858', orgUrls[inst]);
                        links.push({ source: prof.name, target: inst });
                    });
                }
            });

            // ÈÖçÁΩÆÂõæË°®
            option = {
                title: { text: '', top: 'bottom', left: 'right' },
                tooltip: {
                    formatter: function(params) {
                        if (params.dataType === 'node' && params.data.clickUrl) {
                            return params.name + '<br/><span style="font-size:10px; color:#aaa;">(Click to visit website)</span>';
                        }
                        return params.name;
                    }
                },
                legend: [{ data: categories.map(function (a) { return a.name; }) }],
                series: [
                    {
                        type: 'graph',
                        layout: 'force',
                        data: nodes,
                        links: links,
                        categories: categories,
                        roam: true,
                        label: { position: 'right', formatter: '{b}' },
                        lineStyle: { color: 'source', curveness: 0.3 },
                        emphasis: {
                            focus: 'adjacency',
                            lineStyle: { width: 5 }
                        },
                        force: {
                            repulsion: 300,
                            edgeLength: 100
                        }
                    }
                ]
            };

            myChart.setOption(option);

            // ÁÇπÂáª‰∫ã‰ª∂
            myChart.on('click', function(params) {
                if (params.dataType === 'node' && params.data.clickUrl && params.data.clickUrl !== "") {
                    window.open(params.data.clickUrl, '_blank');
                }
            });

        }).fail(function() {
            alert("Error: Could not load data.json. If you are running locally, please use a local server or Firefox.");
        });

        window.onresize = function() { myChart.resize(); };
    </script>
</body>
</html>